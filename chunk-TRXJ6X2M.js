import{a as Z}from"./chunk-DRNA2Y2Q.js";import{a as Ve}from"./chunk-ZC4KGQSM.js";import{a as z,f as Oe,g as $e}from"./chunk-ZMVMZXZP.js";import{a as W,b as X,e as Y}from"./chunk-S73WMLDN.js";import{a as Re}from"./chunk-XMFNPTOA.js";import{a as Me}from"./chunk-TEQY3GTC.js";import{a as Le}from"./chunk-ITUVS2WK.js";import"./chunk-23P6OKCW.js";import{a as k}from"./chunk-7Y7O4CRB.js";import"./chunk-O3HPPMHU.js";import{a as Pe}from"./chunk-LJQV5NXZ.js";import"./chunk-Z5PEOYQJ.js";import"./chunk-7G2AXBS3.js";import{C as G,d as Se,g as Ue,h as De,p as Te,r as we,t as Ee}from"./chunk-Y4NPCKFB.js";import{g as j}from"./chunk-OOKJWEDJ.js";import{Aa as ye,Fa as D,Ua as Ce,Ya as R,jb as I,mb as N,nb as Fe,pb as Ie,ua as q,va as ge,wa as y,ya as O,za as $}from"./chunk-4MVBMYBR.js";import{$a as n,$b as ue,Ab as v,Ba as m,Bb as ce,Ca as d,Dc as _e,Gb as b,Hb as F,Hc as V,I as oe,Ic as T,Kc as C,Mc as be,Nc as x,Ob as de,Pa as H,R as se,Ra as s,W as ne,Yc as B,Z as E,_ as S,a as u,ab as p,b as f,bb as U,ca as h,d as a,fb as me,fc as L,g as te,h as re,ib as c,ic as fe,ja as ae,ka as le,kb as M,r as ie,sa as P,sb as _,tb as pe,vc as he,wc as ve}from"./chunk-NE7DBUAQ.js";var A=(()=>{class r extends T{static from(e){return new r(e)}static getFormKeys(){return[...W.getFormKeys()]}static{this.toJson=e=>e.getRawValue()}}return r})(),ee=(()=>{class r extends T{static from(e){return new r(e)}static getFormKeys(){return[...W.getFormKeys()]}static{this.toJson=e=>e.getRawValue()}}return r})(),xe=()=>{let r=f(u({},Y()),{confirmPassword:new C("",{validators:X}),password:new C("",{validators:X})});return f(u({},r),{roleIds:new C([])})},Q=()=>f(u({},Y()),{roleIds:new C([])});var g=(()=>{class r extends De{get roles$(){return this._roles$.asObservable()}constructor(e,i,t){super(e),this.api=e,this.app=i,this.router=t,this.destroyed$=new te,this._roles$=new re([]),this.roleOptions$=this.roles$.pipe(ie(o=>o.filter(l=>!!l.id&&!!l.name).map(({id:l,name:Ae},Qe)=>({value:l??Qe,label:Ae}))),oe()),this.loadListData=()=>a(this,null,function*(){yield this.loadListItems(R.default())}),this.loadCreateData=()=>a(this,null,function*(){yield this.loadRoles()}),this.loadEditData=o=>a(this,null,function*(){return yield this.loadRoles(),this.loadItem(o)}),this.loadRoles=()=>a(this,null,function*(){let o=yield this.api.getRoles();this._roles$.next(o)}),this.goToList=()=>this.router.navigateByUrl(y.users),this.goToCreate=()=>this.router.navigateByUrl(y.usersCreate),this.goToDetails=(o,l)=>a(this,null,function*(){this.router.navigate([y.usersDetails],{queryParams:{id:o,type:l}})}),this.setToastMessages=()=>{this.toastMessages=f(u({},this.toastMessages),{noItem:"Couldn't fetch user!",createSuccess:"User created successfully!",updateSuccess:"User updated successfully!",updateIdError:"Couldn't update user, couldn't fetch ID!",deleteSuccess:"User deleted successfully!"})},this.setToastMessages(),this.initSubs()}ngOnDestroy(){N.completeDestroy(this.destroyed$)}initSubs(){this.app.clearSessionState$.pipe(se(this.destroyed$)).subscribe(()=>{this._item$.next(void 0),this._listItems$.next([]),this._roles$.next([])})}convertToFormValue(e){let i=e.userRoles??[];return{name:e.name,userName:e.userName,email:e.email,roleIds:i.map(o=>o.roleId).filter(o=>o!=null)}}static{this.\u0275fac=function(i){return new(i||r)(E(Te),E(Se),E(ve))}}static{this.\u0275prov=ne({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();function He(r,ke){if(r&1){let e=me();n(0,"div",12)(1,"app-button",13),c("clicked",function(){ae(e);let t=M();return le(t.openDeleteModal())}),_(2,"Delete"),p()()}if(r&2){let e=M();m(),s("elId",e.elIds.UserDelete)}}function qe(r,ke){if(r&1&&(n(0,"app-button",14),_(1),p()),r&2){let e=M();s("elId",e.elIds.UserSubmit)("disabled",e.form.invalid),m(),pe(e.submitLabel)}}var K=(()=>{class r{get submitLabel(){return I.getSubmitLabel(this.formType)}get canEdit(){return!I.isViewForm(this.formType)}get controls(){return this.form.controls}get isCreateForm(){return I.isCreateForm(this.formType)}get roleOptions$(){return this.service.roleOptions$}constructor(e,i){this.service=e,this.modalService=i,this.save=new P,this.cancel=new P,this.remove=new P,this.elIds=O,this.subscriptions=[],this.passwordVisible=!1,this.visibilityIcon=Z.getVisibilityIcon(()=>this.togglePasswordVisibility()),this.passwordHelpers=Z.getPasswordHelpers(),this.togglePasswordVisibility=()=>{this.passwordVisible=!this.passwordVisible,this.visibilityIcon.color=this.passwordVisible?"primary":"accent"}}showDelete(){return I.isEditForm(this.formType)}onCancel(){this.cancel.emit()}openDeleteModal(){this.modalService.confirmation($(),()=>this.remove.emit())}openSaveModal(){this.modalService.confirmation(ye(),()=>I.onSubmit(this.form,this.save))}static{this.\u0275fac=function(i){return new(i||r)(d(g),d(G))}}static{this.\u0275cmp=h({type:r,selectors:[["app-user-form"]],inputs:{form:"form",formType:"formType"},outputs:{save:"save",cancel:"cancel",remove:"remove"},standalone:!0,features:[v],decls:14,vars:17,consts:[["app-form-layout","",1,"form-layout",3,"ngSubmit","id","formGroup","canEdit"],[1,"form-grid",3,"appScrollTo"],["fcName","userName","labelText","Username","placeholder","Enter the users's username"],["fcName","name","labelText","Name","placeholder","Enter the users's name"],["fcName","email","labelText","Email","placeholder","Enter the users's email"],["fcName","password","placeholder","Enter a password",3,"labelText","type","labelIcon","helpers"],["fcName","confirmPassword","labelText","Confirm Password","placeholder","Confirm password",3,"type","labelIcon"],["fcName","roleIds","labelText","Roles",3,"options","elId","multiple"],[1,"form-buttons"],["class","left-buttons",4,"ngIf"],["model","raised","elId","cUserFormCancel","color","accent",3,"clicked"],["model","raised","type","submit",3,"elId","disabled",4,"ngIf"],[1,"left-buttons"],["model","raised","color","warn",3,"clicked","elId"],["model","raised","type","submit",3,"elId","disabled"]],template:function(i,t){i&1&&(n(0,"form",0),c("ngSubmit",function(){return t.openSaveModal()}),n(1,"div",1),U(2,"app-input",2)(3,"app-input",3)(4,"app-input",4)(5,"app-input",5)(6,"app-input",6)(7,"app-select",7),b(8,"async"),n(9,"div",8),H(10,He,3,1,"div",9),n(11,"app-button",10),c("clicked",function(){return t.onCancel()}),_(12,"Cancel"),p(),H(13,qe,2,3,"app-button",11),p()()()),i&2&&(s("id",t.elIds.UserForm)("formGroup",t.form)("canEdit",t.canEdit),m(),s("appScrollTo",!0),m(4),s("labelText",t.isCreateForm?"Password":"Reset Password")("type",t.passwordVisible?"text":"password")("labelIcon",t.visibilityIcon)("helpers",t.passwordHelpers),m(),s("type",t.passwordVisible?"text":"password")("labelIcon",t.visibilityIcon),m(),s("options",F(8,15,t.roleOptions$))("elId",t.elIds.UserFormRoles)("multiple",!0),m(3),s("ngIf",t.showDelete()),m(3),s("ngIf",t.canEdit))},dependencies:[B,be,V,x,k,Me,Le,Re,ue,j,L],changeDetection:0})}}return r})();var Be=(()=>{class r{constructor(e){this.service=e,this.formType=D.Create}ngOnInit(){this.initForm(),this.loadData()}initForm(){this.form=ee.from(Q())}loadData(){return a(this,null,function*(){yield this.service.loadCreateData()})}submitForm(){return this.create()}create(){return a(this,null,function*(){let e=ee.toJson(this.form),{id:i}=yield this.service.insert(f(u({},e),{userRoles:e.roleIds?.map(t=>({roleId:t}))}));this.service.goToDetails(i,ge.View)})}onCancel(){return this.service.goToList()}static{this.\u0275fac=function(i){return new(i||r)(d(g))}}static{this.\u0275cmp=h({type:r,selectors:[["app-create-user"]],standalone:!0,features:[v],decls:1,vars:2,consts:[[3,"cancel","save","form","formType"]],template:function(i,t){i&1&&(n(0,"app-user-form",0),c("cancel",function(){return t.onCancel()})("save",function(){return t.submitForm()}),p()),i&2&&s("form",t.form)("formType",t.formType)},dependencies:[K],changeDetection:0})}}return r})();var Ne=(()=>{class r{get formType(){return this.pageData?.type?this.pageData?.type:D.Edit}constructor(e,i,t){this.service=e,this.pageService=i,this.cdRef=t,this.subscriptions=[]}ngOnInit(){this.initSubscriptions()}ngOnDestroy(){N.unsub(this.subscriptions)}runInitMethods(){this.initUrlParams(),this.initForm(),this.loadData()}initSubscriptions(){this.subscriptions.push(this.pageService.getQueryParamsObservable().subscribe(()=>{this.runInitMethods()}))}initUrlParams(){this.pageData=this.pageService.getDetailsUrlParams()}loadData(){return a(this,null,function*(){let e=yield this.service.loadEditData(this.pageData?.id);if(e==null){this.service.goToList();return}this.form==null&&(this.form=A.from(Q())),this.form.patchValue(this.service.convertToFormValue(e)),this.form.markAllAsTouched(),this.cdRef.detectChanges()})}initForm(){this.form==null?this.form=A.from(xe()):this.form.patchValue({})}submitForm(){return{[D.Edit]:()=>this.editItem()}[this.formType]()}editItem(){return a(this,null,function*(){let e=A.toJson(this.form);yield this.service.update(this.pageData?.id,f(u({},e),{userRoles:e.roleIds?.map(i=>({roleId:i}))}))})}onRemove(){return a(this,null,function*(){yield this.service.deleteItem(this.pageData?.id),this.service.goToList()})}onCancel(){return this.service.goToList()}static{this.\u0275fac=function(i){return new(i||r)(d(g),d(we),d(de))}}static{this.\u0275cmp=h({type:r,selectors:[["app-user-details"]],standalone:!0,features:[v],decls:1,vars:2,consts:[[3,"cancel","save","remove","form","formType"]],template:function(i,t){i&1&&(n(0,"app-user-form",0),c("cancel",function(){return t.onCancel()})("save",function(){return t.submitForm()})("remove",function(){return t.onRemove()}),p()),i&2&&s("form",t.form)("formType",t.formType)},dependencies:[fe,K],changeDetection:0})}}return r})();var ze=()=>[],je=(()=>{class r{constructor(){this.service=S(g),this.toaster=S(Ue),this.modalService=S(G),this.filterService=S(Ee),this.listItems$=this.service.listItems$,this.total$=this.service.total$,this.lastOptions$=this.service.lastOptions$,this.config={itemConfigs:Ce.tableItems(),orderBy:{key:"id",direction:"asc"},detailsUrl:y.usersDetails,hasDelete:!0,hasEdit:!0,hasView:!0},this.elIds=O,this.deleteItem=e=>a(this,null,function*(){yield this.service.deleteItem(e),this.service.goToList()})}ngOnInit(){this.initFilterForm()}initFilterForm(){let e=new T({name:new C("",{nonNullable:!0,validators:[_e.maxLength(250)]})});this.filterForm=e}onFilter(){this.filterService.filterDebounced(this.loadFilteredItems.bind(this))}applyFilter(){this.filterService.cancelPreviousCall(),this.loadFilteredItems()}loadFilteredItems(){return a(this,null,function*(){let{name:e}=this.filterForm.value;e!==this.prevFilter&&(this.prevFilter=e,yield this.service.loadListItems(this.getPaginationQuery(1)))})}paginate(e){return a(this,null,function*(){if(e==null){this.toaster.error("Error while paginating");return}let{pageIndex:i,pageSize:t}=e;this.service.loadListItems(this.getPaginationQuery(i+1,t))})}getPaginationQuery(e,i){return R.from(e,i??this.service.getItemsPerPage(),{filter:{name:this.prevFilter?[[Fe.Contains,this.prevFilter]]:void 0},orderBy:Ie.orderByToOData(this.config.orderBy)})}openDeleteModal(e){this.modalService.confirmation($(),()=>this.deleteItem(e))}handleOrderBy(){this.service.loadListItems(this.getPaginationQuery(1))}static{this.\u0275fac=function(i){return new(i||r)}}static{this.\u0275cmp=h({type:r,selectors:[["app-user-list"]],standalone:!0,features:[v],decls:8,vars:14,consts:[["id","cUserListContainer"],["app-form-layout","",1,"search-bar",3,"id","formGroup"],["fcName","name","labelText","Search","placeholder","Filter by name","elId","cUserListNameFilter",3,"filter","apply"],[3,"deleteItem","orderByChanged","items","config","elId"],[3,"pageChanged","totalItems","currentPage"]],template:function(i,t){if(i&1&&(n(0,"article",0)(1,"header",1)(2,"app-search",2),c("filter",function(){return t.onFilter()})("apply",function(){return t.applyFilter()}),p()(),n(3,"app-table",3),b(4,"async"),c("deleteItem",function(l){return t.openDeleteModal(l)})("orderByChanged",function(){return t.handleOrderBy()}),p(),n(5,"app-pagination",4),b(6,"async"),b(7,"async"),c("pageChanged",function(l){return t.paginate(l)}),p()()),i&2){let o,l;m(),s("id","cUserList")("formGroup",t.filterForm),m(2),s("items",(o=F(4,7,t.listItems$))!==null&&o!==void 0?o:ce(13,ze))("config",t.config)("elId",t.elIds.UserTable),m(2),s("totalItems",F(6,9,t.total$))("currentPage",(l=(l=F(7,11,t.lastOptions$))==null?null:l.page)!==null&&l!==void 0?l:1)}},dependencies:[k,B,V,x,Ve,$e,Oe,L],styles:[".search-bar[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:flex-end;align-items:center}"],changeDetection:0})}}return r})();var Ge=(()=>{class r{constructor(e){this.service=e,this.paths=y}ngOnInit(){this.service.loadListData()}goToCreate(){this.service.goToCreate()}static{this.\u0275fac=function(i){return new(i||r)(d(g))}}static{this.\u0275cmp=h({type:r,selectors:[["app-users"]],standalone:!0,features:[v],decls:6,vars:1,consts:[[1,"list-header"],["titleText","Users"],["model","link","elId","cUsersButtonCreate",3,"url"]],template:function(i,t){i&1&&(n(0,"header",0),U(1,"app-title",1),n(2,"app-button",2),_(3," Create User "),p()(),U(4,"app-user-list")(5,"router-outlet")),i&2&&(m(2),s("url",t.paths.usersCreate))},dependencies:[Pe,j,je,he],changeDetection:0})}}return r})();var fr=[{path:"",component:Ge,children:[{path:q.Create,component:Be,canDeactivate:[z]},{path:q.Details,component:Ne,canDeactivate:[z]}]}];export{fr as USER_ROUTES};
